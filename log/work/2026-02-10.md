
- 實作了 sb_set_effect_param 的自動重新整理機制：新增 onchange 監聽器，能即時感知並警告樂器容器或效果器缺失。
- 擴充了 sb_set_effect_param 的功能範圍：將 ADSR 與 Panning 設為標配選項，支援在容器無積木時仍可動態調變。
- 在 zh-hant.js 與 en.js 中新增了 SB_ERROR_INSTRUMENT_NOT_FOUND 與 SB_ERROR_EFFECT_NOT_FOUND 警告文字。

- 修正 CLIP 偵測邏輯：移除 mainMixer (訊號鏈中段) 的過載檢查，改為在 draw() 迴圈中監測最終輸出 out.mix。確保 Master Limiter 壓限後不會誤報。

## 2026-02-10 工作日誌 (Gemini CLI)
- **[效能]** 音訊核心大掃除：重構 SBSummer 與 SBPan 移除 uGenerate 內的陣列分配，解決高發聲數卡頓。
- **[音訊]** CLIP 偵測校準：偵測點由 mainMixer 移至最終輸出 out.mix，實現聽覺與視覺的 1:1 對齊。
- **[積木]** sb_set_effect_param 優化：將 ADSR 與 Panning 納入標配選項，支援無積木狀態下的動態調變。
- **[修正]** sb_setup_effect UI 修復：解決混響參數 (ROOMSIZE, DAMPING) 在切換類型時不消失且重複堆疊的 Bug。
- **[相容性]** sb_log_to_screen 修正：支援舊版 XML 的數字型 TYPE 欄位 (0, 1, 2, 3)。
- **[穩定性]** MIDI 選單防呆：加入 myBus 空值檢查，防止未連線時的 InvocationTargetException。
- **[測試]** 建立 ex_99_Stress_Test.xml：用於驗證高負載演奏與 Master Limiter 穩定性。

- **[架構重構]** 實作模組化拆分：
    - 建立 \media/utils.js\：收納 Polyfills、按鍵管理、孤兒積木檢查及 Mutators 等通用輔助函式。
    - 拆分 \blocks/audio.js\ 與 \generators/audio.js\ 為 \audio_core.js\、\audio_performance.js\ 與 \audio_effects.js\。
    - 優化 \module_loader.js\ 載入流程，並在 \extension.ts\ 中預載通用工具。
    - 修正 \sb_set_wave\ 在語系檔中的佔位符不匹配問題。

- **[架構優化] 深度模組化拆分完成**：
    - **工具層**：建立 \media/utils.js\，統一管理 Polyfills、按鍵衝突偵測、孤兒積木檢查，以及音訊類積木共用的 Mutators 與下拉選單邏輯。
    - **積木層**：將 \blocks/audio.js\ 拆分為 \audio_core.js\ (初始化/容器)、\audio_performance.js\ (演奏/音序)、\audio_effects.js\ (效果器)。
    - **產生器層**：將 Java 核心代碼注入邏輯移至 \_core.js\，並同步拆分音訊產生器模組。
- **[修正] 模組化後的穩定性修復**：
    - **語系同步**：修正 \sb_set_wave\ 翻譯標籤缺失 \%1\ 導致的 XML 載入崩潰。
    - **環境變數**：修正 \FieldMultilineInput\ 在拆分模組中的呼叫路徑。
    - **代碼轉義**：解決產生器 JS 檔案中因轉義失效導致的實體換行 (SyntaxError)。
    - **Java 語法**：修正 \playNoteInternal\ 中 UGen 連鎖呼叫 (\.patch().noteOn()\) 導致的編譯錯誤。

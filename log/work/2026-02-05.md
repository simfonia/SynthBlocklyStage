## 2026-02-05 工作日誌

### Git 歷史修剪
- 解決了因合併遠端變更導致的線性歷史分叉問題。
- 透過 stash -> reset --hard -> push -f 的流程，將分支恢復到正確的提交點並保持歷史線性。

### 音訊引擎核心重構
- **統一訊號鏈 (Unified Signal Chain)**：引入 mainMixer (Summer) 與 masterGainUGen (Gain)。
- **修復示波器**：現在能正確捕捉所有音源（合成器、取樣器、預備拍），不再受總音量衰減影響視覺顯示。
- **修復 Master Gain**：確保 Gain 控制能 100% 涵蓋包含取樣器在內的所有樂器。
- **NullPointerException 修復**：建立 checkMainMixer() 輔助函式，解決樂器初始化早於舞台建立時的物件遺失錯誤。

### ADSR 視覺與邏輯穩定化
- **消除鬼影移動**：初始化 dsrState = 0 並在切換樂器時強制重置光點，解決啟動或切換時光點自行移動的問題。
- **語音記憶系統 (Voice Memory)**：為 MIDI 與 PC 鍵盤實作 midiKeysHeld 記憶體，確保在彈奏中切換樂器仍能正確釋放前一個樂器的音符，解決長鳴音問題。
- **視覺優化**：移除 Sustain 階段的震盪動畫，改為靜止顯示以增加視覺穩定感。

### 新功能與積木擴充
- **音樂性等待**：新增 sb_wait_musical 積木，支援「拍」、「小節」（含小數點）及秒、毫秒單位。
- **配置樂句 (Arrange Phrase)**：新增容器積木，支援多軌音序器同步啟動與自動段落銜接。
- **進階音序器 V2**：支援單一積木多軌管理、自訂小節拍數與每拍切分數 (Resolution)，支援三連音編排。
- **移調功能回歸**：補回 +/= 與 - 鍵的半音階移調功能，並強化 Log 提示（顯示當前 Transpose 數值）。

### UI 與基礎建設修復
- **對話框橋接**：解決 Webview 沙盒限制，實作 VS Code 原生 InputBox 攔截 Blockly 變數建立請求。
- **UI 層級修正**：調整 MIDI 與 Serial 選單初始化順序，解決選單展開時被遮擋的 Z-Order 問題。
- **預備拍優化**：改用三角形波並延長持續時間至 100ms，確保示波器能穩定捕捉。

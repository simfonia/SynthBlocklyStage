## 2026-02-08 工作紀錄
### 音訊演奏與即時觸發優化 (Performance & Live Trigger)
- **樂器指定功能對齊**：
  - 將 \sb_play_note\ (演奏持續音) 與 \sb_stop_note\ (停止持續音) 由 JSON 定義改為手動定義，並加入樂器動態選單。
  - 這解決了在即時演奏時無法指定不同樂器的限制，並確保持續音的開啟與關閉能精確作用於特定樂器。
  - 將這兩個積木的顏色改為亮橘色 (#D35400)，與普通的編曲型演奏積木做出視覺區隔。
- **PC 鍵盤事件強化**：
  - 更新 \ui_key_event\ 積木，新增「按下 (Pressed) / 放開 (Released)」切換選單。
  - 修正 Java 產生器：現在代碼會依據選單設定，分別注入到 Processing 的 \oid keyPressed()\ 或 \oid keyReleased()\ 佔位符中。
  - 完善了即時演奏的「按多久、響多久」邏輯鏈，支援複雜的互動樂器設計。
- **核心產生器升級**：
  - 修改 \_core.js\ 的 \inish\ 函式，新增 \{{KEY_RELEASED_EVENT_PLACEHOLDER}}\ 處理邏輯。
  - 優化 i18n 訊息結構，確保繁體中文與英文在多選單積木中的語法流暢性。
- 調整了 sb_play_note 與 sb_stop_note 的產生器，使其支援指定樂器的持續音控制。
- 修正了 i18n 訊息，確保介面文字在多語系下的一致性。

- 強化了 sb_play_note 與 sb_stop_note 的音高輸入，現在同時支援 MIDI 編號與音名 (如 'C4')。
- 在 _core.js 中新增 Java 輔助函式 getMidi，統一處理各類音高格式轉換。

- 優化了演奏積木的 UI 排版，將音高與力度標籤直接與插槽綁定，避免文字錯位。
- 確保所有音訊產生器皆使用動態轉型機制 (getMidi, floatVal)。

- 全面重整所有具備樂器選單的積木 UI 排版 (演奏單音、播放和弦、播放旋律、音量、相位)。
- 採用「標籤與輸入緊密綁定」的拆分結構，解決了多語系下文字對齊錯位與堆疊問題。
- 同步更新 en.js 與 zh-hant.js 以支援新的拆分欄位標籤。
- 修正 sb_play_chord_by_name 產生器中的冗餘代碼與轉型邏輯。

- 補全了 toolbox.xml 中所有重整後積木的影子積木 (Shadow Blocks)，確保預設值顯示正常。

- 修正了步進音序器 (sb_rhythm_sequence) 的 UI 排版，統一採用拆分 Input 結構，確保參數順序與翻譯文字正確對齊。

- 實作了翻譯鍵值的原子化拆分 (Atomic Translation Keys)，徹底移除了積木定義中脆弱的 split() 邏輯。
- 這確保了所有語系下的積木排版都能精確對齊，不再受翻譯語序或字元長度影響。

- 修正了滑鼠將積木拉出 Webview 邊界後導致的拖曳失常行為。
- 參考 #piBlockly 實作了 window 'blur' 事件監聽器，當視窗失去焦點且處於拖曳狀態時，強制呼叫 Blockly.Gesture.clearForced() 以釋放積木。

- 同時修正了 #SynthBlockly 專案中的 Webview 邊界拖曳失常行為，確保兩大專案的一致性。

- 實作了嚴格的「孤兒積木」限制機制。
- 只有帽子積木 (Hat Blocks) 與容器積木 (Containers) 允許放在工作區頂層，其餘積木若未接在正確流程中將自動失效並呈現灰色。
- 此機制已同步套用於 #SynthBlocklyStage 與 #SynthBlockly 兩大專案。


# 2026-02-03 工作日誌

## 1. 演奏引擎與積木架構優化
- **動態選單實作**：為「播放旋律」、「播放和弦」、「步進音序器」及「播放單音」積木實作了動態下拉選單，自動感應工作區已定義的樂器與和弦名稱。
- **統一演奏語法**：將「觸發音訊播放」升級為「播放單音」，支援與旋律播放一致的 \C4Q\, \RE\, \XQ\ 語法，並改為阻塞式 (Blocking) 以符合序列邏輯。
- **帽子積木更名**：將「音頻執行一次」更名為「演奏」，支援多個演奏積木同時並行（多聲部），內部積木則維持循序執行。
- **解決全灰與閃退**：
    - 在背景執行緒啟動時加入 200ms 延遲，確保 UI 先渲染再發聲。
    - 修復了 \provideSetup\ 覆寫 Bug，現在多個帽子積木可產生並列的 Thread。
    - 優化 \ctiveMelodyCount\ 生命週期，解決音符間隙導致的誤判結束問題。

## 2. 旋律取樣器實作 (Melodic Sampler)
- **智慧變調引擎**：實作 Java 端 \MelodicSampler\ 類別，支援自動掃描資料夾、音名解析及基於 \TickRate\ 的智慧音高偏移。
- **內建音源對齊**：預設提供 Piano, Violin (Pizz/Arco) 取樣路徑，並支援 \data/\ 下的自訂路徑載入。
- **情境感知 ADSR**：針對取樣樂器實作 ADS 略過機制，保留真實起音細節，僅開放 Release (R) 控制餘韻，並於積木介面提供視覺提示。

## 3. 介面與視覺積木
- **工具箱重整**：
    - 新增「設定幀率 (frameRate)」積木。
    - 將「偵測幀數 (frameCount)」移至視覺繪圖分類。
    - 統一「音樂演奏」分類積木為橘色。
- **防呆與光暈**：實作「多音源警告」，當樂器容器內有複數音源時，積木會發出黃色光暈並提示覆寫風險。
- **音量控制**：新增「設定樂器音量」積木，達成對合成器、取樣器、音序器的全方位獨立音量管理。

## 4. 基礎建設與 Bug 修復
- **音訊解鎖**：修正 Webview 的 \NotAllowedError\，在使用者第一次點擊後才啟用 Blockly 音效。
- **文件標準化**：統一 \helpUrl\ 處理流程（基礎檔名自動補綴），更新 \sound_sources\ 說明文件至最新規範。
- **產生器修復**：修正了多處 JS 與 Java 語法拼接錯誤、Mutator 欄位對應錯誤及大小寫解析問題。


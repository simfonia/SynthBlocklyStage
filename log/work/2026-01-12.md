# 2026-01-12 工作日誌

## 任務：實作「即時表演」控制系統、完善 Serial 通訊與 UI 體驗優化

### 1. 「即時表演 (Live Show)」系統建置
- **專屬分類與變數**：在工具箱新增「即時表演」分類（深藍灰色），整合了 `visual_stage_setup` 與新實作的 `live_set_param` / `live_get_param` 積木。
- **動態參數控制**：支援透過積木即時修改 9 種全域表演變數（`waveScale`, `trailAlpha`, `fgHue`, `masterGain`, `pitchTranspose`, `adsrA/D/S/R`）。
- **說明文件對齊**：更新 `visual_stage_zh-hant.html`，詳細表列所有控制變數的物理意義與建議數值範圍。

### 2. 視覺特效豐富化 (Visual Variety)
- **同色系位移**：ADSR 監控線改為 `fgHue + 40` 度偏移，增加視覺層次。
- **頻率熱力漸層**：實作了頻譜圖的動態漸層效果，高低頻會隨頻率索引產生色相變化，表演效果大幅提升。

### 3. Serial (Arduino) 互動系統完備
- **動態埠號選擇**：在超級舞台新增「SERIAL PORT」下拉選單，支援執行期動態掃描與即時切換連接埠，並具備 Port Busy 例外處理。
- **事件驅動帽子積木**：實作 `sb_serial_data_received`，在 Java 端生成 `serialEvent(Serial p)`，支援非阻塞式的高效能資料接收。
- **通訊除錯強化**：接收到的 Serial 資料會同步印至 Processing 控制台並顯示於舞台的 CONSOLE 面板。
- **位元運算支援**：新增 `serial_check_mask` 積木，完美對接 TTP229 等硬體觸發板。

### 4. UI 佈局與功能優化
- **日誌管理強化**：在日誌面板上方新增「COPY LOG」與「CLEAR LOG」按鈕，實作了跨平台的剪貼簿複製功能。
- **對齊修正**：統一按鈕寬度至 90px，並透過 `setMarginTop` 解決了 ControlP5 文字垂直偏移的長久問題。
- **路徑設定自動化**：新增工具列「設定」按鈕。若執行時找不到 `processing-java.exe`，系統會主動彈出警告並自動開啟路徑選取對話框。

### 5. 產生器與穩定性修正
- **字串比較修復**：修正 `logic_compare` 產生器，在偵測到字串或 `serial_data` 時自動改用 Java 的 `.equals()` 語法，解決邏輯判斷失效的 Bug。
- **強型別轉型優化**：在數學積木中加入 `float()` 轉換邏輯，確保 Serial 傳回的字串能被正確運算而不產生編譯錯誤。
- **插件整合**：成功解決了多行註解插件在 Webview 沙盒環境下的載入順序與註冊衝突問題。

### 6. 部署準備
- **全域資源共享**：修改 Extension 連結邏輯，支援 `examples/data` 全域共享資料夾，避免重複複製音訊樣本。
- **打包優化**：建立 `.vscodeignore` 並排除龐大的 `processing-3.5.4` 資料夾，將 VSIX 體積精簡至數 MB。

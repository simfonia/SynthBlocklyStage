# 工作日誌 2026-02-20

## 系統架構與文件
- **[文件]** 建立 docs/system_spec.html (v1.4)，作為專案真理來源。
- **[規範]** 在 GEMINI.md 中加入「文件維護規範」，要求開發時同步更新規格書。
- **[型別]** 建立完整的「動態型別轉換規範」，處理 Blockly 與 Java (PDE) 間的 float/int/String 轉換。

## 序列埠與硬體整合 (TTP229)
- **[範例]** 建立 ex_15_TTP229_Multi_Drum，展示專業級多鍵同時觸控 Drum Pad 實作。
- **[通訊]** 實作 16-bit 狀態字串解析與邊緣偵測邏輯。
- **[修復]** 修正 checkKeyMask 輔助函式，支援 KEY:n (單鍵) 與 KEYS:n (位元遮罩) 雙模式。
- **[優化]** 提升所有取樣器複音數至 20，並將演奏單音改為非阻塞執行緒模式，解決連擊延遲。

## 產生器強化 (Type Safety)
- **[Logic]** 強化 logic_compare 的字串偵測啟發式演算法，避免 Java 原始型別編譯錯誤。
- **[Text]** 修正 	ext_charAt 為物件導向模式，加入 String.valueOf() 與 (int) 轉型安全網。
- **[Lists]** 為列表操作索引加入強制轉型。
- **[Core]** 優化 getMidi 以相容來自 float 的字串格式。

## UI 與 Bug 修復
- **[UI]** 重構 sb_serial_data_received 積木外觀為多行顯示。
- **[Bug]** 修正「另存新檔」取消後 Dirty 標記被錯誤清除的問題。
